local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "SINGULATION.WTF V.1.0.0",
    SubTitle = "CB:RO FULL & FIXED",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 620),
    Acrylic = false,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.RightControl
})

local Tabs = {
    Combat = Window:AddTab({ Title = "Combat", Icon = "crosshair" }),
    Movement = Window:AddTab({ Title = "Movement", Icon = "move" }),
    Visuals = Window:AddTab({ Title = "Visuals", Icon = "eye" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Drawing элементы
local Cursor1 = Drawing.new("Line"); Cursor1.Thickness = 1
local Cursor2 = Drawing.new("Line"); Cursor2.Thickness = 1
local SilentCircle = Drawing.new("Circle")
SilentCircle.Thickness = 1
SilentCircle.NumSides = 64
SilentCircle.Filled = false
SilentCircle.Transparency = 1

local TracersStore = {}
local EspStore = {}
local LastHealth = {}

local function GetRGB() return Color3.fromHSV(tick() * 0.5 % 1, 1, 1) end

-------------------------------------------------------------------------------
-- ФУНКЦИИ (ЗВУК И НЕБО)
-------------------------------------------------------------------------------
local function PlayHitSound()
    local sound = Instance.new("Sound", game:GetService("SoundService"))
    sound.SoundId = "rbxassetid://1255557831"
    sound.Volume = 5
    sound:Play()
    game:GetService("Debris"):AddItem(sound, 1)
end

local function SetSkybox(state)
    if state then
        local sky = Lighting:FindFirstChild("CustomSky") or Instance.new("Sky", Lighting)
        sky.Name = "CustomSky"
        sky.SkyboxBk = "rbxassetid://271042516"
        sky.SkyboxDn = "rbxassetid://271077243"
        sky.SkyboxFt = "rbxassetid://271042310"
        sky.SkyboxLf = "rbxassetid://271042988"
        sky.SkyboxRt = "rbxassetid://271042730"
        sky.SkyboxUp = "rbxassetid://271077958"
        Lighting.ClockTime = 0
    else
        if Lighting:FindFirstChild("CustomSky") then Lighting.CustomSky:Destroy() end
        Lighting.ClockTime = 14
    end
end

-------------------------------------------------------------------------------
-- ЛОГИКА SILENT AIM (ИЗ TXT)
-------------------------------------------------------------------------------
local function StartQuotasSilentAim()
    task.spawn(function()
        while true do
            task.wait(0.3)
            if Options.SilentAim and Options.SilentAim.Value then
                pcall(function()
                    for _, v in pairs(Players:GetPlayers()) do
                        if v ~= LP and v.Character and (v.Team ~= LP.Team or v.Team == nil) then
                            local root = v.Character:FindFirstChild("HumanoidRootPart")
                            local hum = v.Character:FindFirstChild("Humanoid")
                            if root and hum and hum.Health > 0 then
                                local pos, onScreen = Camera:WorldToViewportPoint(root.Position)
                                local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
                                local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                                
                                if dist <= Options.SilentFov.Value then
                                    local parts = {"RightUpperLeg", "LeftUpperLeg", "HeadHB", "HumanoidRootPart", "Head"}
                                    for _, pName in pairs(parts) do
                                        local part = v.Character:FindFirstChild(pName)
                                        if part then
                                            part.CanCollide = false
                                            part.Transparency = 10
                                            part.Size = Vector3.new(Options.HitboxSize.Value, Options.HitboxSize.Value, Options.HitboxSize.Value)
                                        end
                                    end
                                end
                            end
                        end
                    end
                end)
            end
        end
    end)
end

-------------------------------------------------------------------------------
-- UI ЭЛЕМЕНТЫ (COMBAT)
-------------------------------------------------------------------------------
Tabs.Combat:AddToggle("SilentAim", {Title = "OP Head Hitbox (Silent Aim)", Default = false})
Tabs.Combat:AddSlider("HitboxSize", {Title = "Head Size", Default = 15, Min = 1, Max = 100, Rounding = 1})
Tabs.Combat:AddSlider("SilentFov", {Title = "Silent Aim FOV", Default = 150, Min = 10, Max = 800, Rounding = 0})
Tabs.Combat:AddToggle("HitSound", {Title = "Hit Sound (Bell)", Default = false})
Tabs.Combat:AddToggle("NoSpread", {Title = "No Spread", Default = true})
Tabs.Combat:AddToggle("NoRecoil", {Title = "No Recoil", Default = true})
Tabs.Combat:AddToggle("Spinbot", {Title = "Hard Spinbot", Default = false})
Tabs.Combat:AddSlider("SpinSpeed", {Title = "Spin Speed", Default = 50, Min = 1, Max = 300, Rounding = 0})

-------------------------------------------------------------------------------
-- UI ЭЛЕМЕНТЫ (MOVEMENT)
-------------------------------------------------------------------------------
Tabs.Movement:AddToggle("Bhop", {Title = "Bhop", Default = false})
Tabs.Movement:AddSlider("BhopSpeed", {Title = "Bhop Speed", Default = 25, Min = 10, Max = 100, Rounding = 0})
Tabs.Movement:AddToggle("Fly", {Title = "Fly Mode", Default = false})
Tabs.Movement:AddSlider("FlySpeed", {Title = "Fly Speed", Default = 50, Min = 10, Max = 300, Rounding = 0})

-------------------------------------------------------------------------------
-- UI ЭЛЕМЕНТЫ (VISUALS)
-------------------------------------------------------------------------------
Tabs.Visuals:AddToggle("Esp", {Title = "Highlight ESP", Default = false})
Tabs.Visuals:AddToggle("EspNames", {Title = "Show Names", Default = false})
Tabs.Visuals:AddToggle("EspHealth", {Title = "Show Health Bar", Default = false})
Tabs.Visuals:AddToggle("Tracers", {Title = "Tracers", Default = false})
Tabs.Visuals:AddToggle("Crosshair", {Title = "RGB Pro-Crosshair", Default = true})
Tabs.Visuals:AddToggle("NightMode", {Title = "Night Skybox", Default = false}):OnChanged(function(v) SetSkybox(v) end)
Tabs.Visuals:AddToggle("ThirdPerson", {Title = "Unlock Third Person", Default = false})

-------------------------------------------------------------------------------
-- ЛОГИКА WEAPON MODS
-------------------------------------------------------------------------------
task.spawn(function()
    while task.wait(5) do
        if Options.NoSpread.Value or Options.NoRecoil.Value then
            pcall(function()
                for _, v in pairs(getgc(true)) do
                    if type(v) == "table" and (rawget(v, "Spread") or rawget(v, "Accuracy")) then
                        if Options.NoSpread.Value then
                            v.Spread = 0; v.Accuracy = 0; v.WepSpread = 0; v.MaxSpread = 0
                            if v.ConeControl then v.ConeControl = 0 end
                        end
                        if Options.NoRecoil.Value then
                            v.Recoil = 0; v.RecoilX = 0; v.RecoilY = 0
                        end
                    end
                end
            end)
        end
    end
end)

-------------------------------------------------------------------------------
-- ESP HELPER
-------------------------------------------------------------------------------
local function CreateEsp(p)
    local data = {
        Name = Drawing.new("Text"),
        HealthOutline = Drawing.new("Line"),
        HealthBar = Drawing.new("Line")
    }
    data.Name.Size = 14; data.Name.Center = true; data.Name.Outline = true; data.Name.Visible = false
    EspStore[p] = data
end

-------------------------------------------------------------------------------
-- ГЛАВНЫЙ ЦИКЛ РЕНДЕРА (VISUALS + HIT SOUND)
-------------------------------------------------------------------------------
RunService.RenderStepped:Connect(function()
    local color = GetRGB()
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    -- Crosshair
    if Options.Crosshair.Value then
        local spin = tick() * 12
        Cursor1.Visible = true; Cursor1.Color = color
        Cursor1.From = center + Vector2.new(math.cos(spin)*12, math.sin(spin)*12); Cursor1.To = center + Vector2.new(math.cos(spin+math.pi)*12, math.sin(spin+math.pi)*12)
        Cursor2.Visible = true; Cursor2.Color = color
        Cursor2.From = center + Vector2.new(math.cos(spin+math.pi/2)*12, math.sin(spin+math.pi/2)*12); Cursor2.To = center + Vector2.new(math.cos(spin-math.pi/2)*12, math.sin(spin-math.pi/2)*12)
    else
        Cursor1.Visible = false; Cursor2.Visible = false
    end
    
    SilentCircle.Visible = Options.SilentAim.Value; SilentCircle.Position = center; SilentCircle.Radius = Options.SilentFov.Value; SilentCircle.Color = color

    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LP then
            if not EspStore[p] then CreateEsp(p) end
            local e = EspStore[p]
            local char = p.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            local hrp = char and char:FindFirstChild("HumanoidRootPart")

            if char and hum and hrp and hum.Health > 0 then
                -- Звук попадания
                if Options.HitSound.Value and (p.Team ~= LP.Team or p.Team == nil) then
                    if LastHealth[p] and hum.Health < LastHealth[p] then PlayHitSound() end
                    LastHealth[p] = hum.Health
                end

                local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                local enemy = (p.Team ~= LP.Team or p.Team == nil)

                -- Никнеймы
                if onScreen and enemy and Options.EspNames.Value then
                    e.Name.Visible = true; e.Name.Text = p.Name; e.Name.Position = Vector2.new(pos.X, pos.Y - 40); e.Name.Color = color
                else e.Name.Visible = false end

                -- Хилбары
                if onScreen and enemy and Options.EspHealth.Value then
                    local hp = math.clamp(hum.Health/hum.MaxHealth, 0, 1)
                    e.HealthOutline.Visible = true; e.HealthBar.Visible = true
                    e.HealthOutline.From = Vector2.new(pos.X-20, pos.Y-20); e.HealthOutline.To = Vector2.new(pos.X-20, pos.Y+20); e.HealthOutline.Color = Color3.new(0,0,0); e.HealthOutline.Thickness = 3
                    e.HealthBar.From = Vector2.new(pos.X-20, pos.Y+20); e.HealthBar.To = Vector2.new(pos.X-20, pos.Y+20-(40*hp)); e.HealthBar.Color = Color3.fromHSV(hp*0.3, 1, 1); e.HealthBar.Thickness = 2
                else e.HealthOutline.Visible = false; e.HealthBar.Visible = false end

                -- Highlight
                local h = char:FindFirstChild("Highlight")
                if enemy and Options.Esp.Value then
                    if not h then h = Instance.new("Highlight", char) end
                    h.Enabled = true; h.FillColor = color
                elseif h then h.Enabled = false end

                -- Tracers
                if enemy and onScreen and Options.Tracers.Value then
                    if not TracersStore[p] then TracersStore[p] = Drawing.new("Line") end
                    TracersStore[p].Visible = true; TracersStore[p].From = Vector2.new(center.X, Camera.ViewportSize.Y); TracersStore[p].To = Vector2.new(pos.X, pos.Y); TracersStore[p].Color = color
                elseif TracersStore[p] then TracersStore[p].Visible = false end
            else
                -- Скрываем если мертв
                e.Name.Visible = false; e.HealthBar.Visible = false; e.HealthOutline.Visible = false
                if TracersStore[p] then TracersStore[p].Visible = false end
                if char and char:FindFirstChild("Highlight") then char.Highlight.Enabled = false end
            end
        end
    end
end)

-------------------------------------------------------------------------------
-- ЛОГИКА MOVEMENT
-------------------------------------------------------------------------------
RunService.Heartbeat:Connect(function()
    if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = LP.Character.HumanoidRootPart
        local hum = LP.Character:FindFirstChild("Humanoid")
        
        -- Fly
        if Options.Fly.Value then
            hrp.Velocity = Vector3.new(0, 0.1, 0)
            local move = Vector3.new()
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= Camera.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += Camera.CFrame.RightVector end
            hrp.CFrame += move * (Options.FlySpeed.Value / 50)
        end
        
        -- Bhop
        if Options.Bhop.Value and UserInputService:IsKeyDown(Enum.KeyCode.Space) and hum then
            hum.Jump = true
            if hum.MoveDirection.Magnitude > 0 then
                hrp.Velocity = Vector3.new(hum.MoveDirection.X * Options.BhopSpeed.Value, hrp.Velocity.Y, hum.MoveDirection.Z * Options.BhopSpeed.Value)
            end
        end
        
        -- Spinbot
        if Options.Spinbot.Value then
            hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(Options.SpinSpeed.Value), 0)
        end
    end
    LP.CameraMaxZoomDistance = Options.ThirdPerson.Value and 40 or 0.5
end)

StartQuotasSilentAim()
SaveManager:SetLibrary(Fluent); InterfaceManager:SetLibrary(Fluent)
InterfaceManager:BuildInterfaceSection(Tabs.Settings); SaveManager:BuildConfigSection(Tabs.Settings)
Window:SelectTab(1)
