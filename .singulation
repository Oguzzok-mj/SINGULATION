-- // OPTIMIZED SINGULATION.WTF
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "SINGULATION.WTF V.1.8.1 (OPTIMIZED)",
   LoadingTitle = "CB:RO ULTIMATE - STABLE",
   LoadingSubtitle = "FIXED by sgla.t",
   ConfigurationSaving = { Enabled = true, FolderName = "Singulation", FileName = "Config" },
   KeySystem = false
})

-- // СЕРВИСЫ (КЭШ)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Stats = game:GetService("Stats")
local Debris = game:GetService("Debris")
local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- // DRAWING ОБЪЕКТЫ (RE-USE)
local Cursor1 = Drawing.new("Line"); Cursor1.Thickness = 1
local Cursor2 = Drawing.new("Line"); Cursor2.Thickness = 1
local SilentCircle = Drawing.new("Circle")
SilentCircle.Thickness = 1; SilentCircle.NumSides = 32 -- Уменьшено для FPS
local LegitCircle = Drawing.new("Circle")
LegitCircle.Thickness = 1; LegitCircle.NumSides = 32

-- // UI
local SpecGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
local SpecLabel = Instance.new("TextLabel", SpecGui)
SpecLabel.Size = UDim2.new(0, 200, 0, 300); SpecLabel.Position = UDim2.new(0, 15, 0.4, 0)
SpecLabel.BackgroundTransparency = 1; SpecLabel.TextColor3 = Color3.new(1, 1, 1); SpecLabel.Font = Enum.Font.Code; SpecLabel.TextSize = 14; SpecLabel.TextXAlignment = Enum.TextXAlignment.Left; SpecLabel.TextYAlignment = Enum.TextYAlignment.Top

local WLabel = Instance.new("TextLabel", Instance.new("ScreenGui", game:GetService("CoreGui")))
WLabel.Size = UDim2.new(0, 300, 0, 20); WLabel.Position = UDim2.new(0.4, 0, 0, 5)
WLabel.BackgroundTransparency = 1; WLabel.Font = Enum.Font.Code; WLabel.TextSize = 14

-- // ХРАНИЛИЩА
local EspStore = {}
local TracersStore = {}

local State = {
    SilentAim = false, HitboxSize = 15, SilentFov = 150, HitboxTransparency = 0.8, Spinbot = false, SpinSpeed = 50,
    LegitAim = false, LegitSmooth = 5, LegitFov = 100, LegitPart = "Head",
    HitSound = false, NoRecoil = true,
    Bhop = false, BhopSpeed = 25, Fly = false, FlySpeed = 50,
    Esp = false, EspNames = false, EspHealth = false, Tracers = false,
    Crosshair = true, SpecList = true, CameraFOV = 80, ThirdPerson = false,
    HandMaterial = "Default", HandTransparency = 0, HandColor = Color3.fromRGB(255, 255, 255),
    NightMode = false, WorldTint = Color3.fromRGB(255, 255, 255), Brightness = 1, Exposure = 0
}

-- // ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
local function GetRGB() return Color3.fromHSV(tick() * 0.5 % 1, 1, 1) end

-- // ВКЛАДКИ (Без изменений названий)
local TabRage = Window:CreateTab("Rage Bot", "zap")
local TabLegit = Window:CreateTab("Legit Bot", "crosshair")
local TabMovement = Window:CreateTab("Movement", "move")
local TabVisuals = Window:CreateTab("Visuals", "eye")
local TabWorld = Window:CreateTab("World", "map")

-- [Здесь должны быть твои Tab:CreateToggle/Slider - логика та же]
-- ... (пропущено для краткости, оставь свои вызовы функций как были)

-- // ОПТИМИЗИРОВАННЫЙ ЦИКЛ ОБНОВЛЕНИЯ МИРА (Раз в 0.5 сек вместо каждого кадра)
task.spawn(function()
    while task.wait(0.5) do
        Lighting.ClockTime = State.NightMode and 0 or 14
        Lighting.Ambient = State.WorldTint
        Lighting.OutdoorAmbient = State.WorldTint
        Lighting.Brightness = State.Brightness
        Lighting.ExposureCompensation = State.Exposure
        
        -- Очистка кэша ESP для вышедших игроков
        for player, _ in pairs(EspStore) do
            if not player or not player.Parent then
                for _, draw in pairs(EspStore[player]) do draw:Remove() end
                EspStore[player] = nil
            end
        end
    end
end)

-- // ГЛАВНЫЙ ЦИКЛ РЕНДЕРА
RunService.RenderStepped:Connect(function()
    local color = GetRGB()
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    WLabel.Text = string.format("SINGULATION.WTF | %d FPS | %dms", math.floor(1/workspace:GetRealPhysicsFPS()), math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue()))
    WLabel.TextColor3 = color
    Camera.FieldOfView = State.CameraFOV

    -- Оптимизированный ESP
    for _, p in ipairs(Players:GetPlayers()) do
        if p == LP then continue end
        
        local char = p.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        local hum = char and char:FindFirstChild("Humanoid")
        local enemy = (p.Team ~= LP.Team or p.Team == nil)

        if not hrp or not hum or hum.Health <= 0 or not enemy then
            if EspStore[p] then 
                EspStore[p].Name.Visible = false
                EspStore[p].HOutline.Visible = false
                EspStore[p].HBar.Visible = false
            end
            if TracersStore[p] then TracersStore[p].Visible = false end
            continue
        end

        local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
        
        -- Highlight (оптимизировано)
        if State.Esp then
            local h = char:FindFirstChild("Highlight") or Instance.new("Highlight", char)
            h.FillColor = color
            h.Enabled = true
        elseif char:FindFirstChild("Highlight") then
            char.Highlight.Enabled = false
        end

        if onScreen then
            if not EspStore[p] then
                EspStore[p] = {
                    Name = Drawing.new("Text"), HOutline = Drawing.new("Line"), HBar = Drawing.new("Line")
                }
                EspStore[p].Name.Size = 14; EspStore[p].Name.Center = true; EspStore[p].Name.Outline = true
            end

            local e = EspStore[p]
            local h = math.abs(Camera:WorldToViewportPoint(hrp.Position + Vector3.new(0, 3, 0)).Y - Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0, 3.5, 0)).Y)
            local w = h / 2

            if State.EspNames then
                e.Name.Visible = true
                e.Name.Text = string.format("%s [%dm]", p.Name, math.floor((hrp.Position - LP.Character.HumanoidRootPart.Position).Magnitude))
                e.Name.Position = Vector2.new(pos.X, pos.Y - (h/2) - 15)
                e.Name.Color = color
            else e.Name.Visible = false end

            if State.EspHealth then
                local pct = hum.Health / hum.MaxHealth
                e.HOutline.Visible = true; e.HBar.Visible = true
                e.HOutline.From = Vector2.new(pos.X - w/2 - 5, pos.Y - h/2)
                e.HOutline.To = Vector2.new(pos.X - w/2 - 5, pos.Y + h/2)
                e.HBar.From = Vector2.new(pos.X - w/2 - 5, pos.Y + h/2)
                e.HBar.To = Vector2.new(pos.X - w/2 - 5, pos.Y + h/2 - (h * pct))
                e.HBar.Color = Color3.fromHSV(pct * 0.3, 1, 1)
            else e.HOutline.Visible = false; e.HBar.Visible = false end
        else
            if EspStore[p] then for _, v in pairs(EspStore[p]) do v.Visible = false end end
        end
    end

    -- Crosshair & FOV Circles
    if State.Crosshair then
        local spin = tick() * 10
        Cursor1.Visible = true; Cursor1.Color = color
        Cursor1.From = center + Vector2.new(math.cos(spin)*10, math.sin(spin)*10)
        Cursor1.To = center + Vector2.new(math.cos(spin+3.14)*10, math.sin(spin+3.14)*10)
    else Cursor1.Visible = false end

    SilentCircle.Visible = State.SilentAim; SilentCircle.Position = center; SilentCircle.Radius = State.SilentFov; SilentCircle.Color = color
end)

-- // МОДИФИКАЦИЯ ОРУЖИЯ (ОПТИМИЗИРОВАНО: РАЗ В 2 СЕКУНДЫ)
task.spawn(function()
    while task.wait(2) do
        if State.NoRecoil then
            for _, v in pairs(getgc(true)) do
                if type(v) == "table" and rawget(v, "Recoil") then
                    v.Recoil = 0; v.Spread = 0; v.MaxSpread = 0
                end
            end
        end
    end
end)

-- // LEGIT AIM (MOUSEMOVE FIX)
task.spawn(function()
    while task.wait() do
        if State.LegitAim then
            local target = nil
            local minDist = State.LegitFov
            local mousePos = UserInputService:GetMouseLocation()

            for _, v in ipairs(Players:GetPlayers()) do
                if v ~= LP and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then
                    local part = v.Character:FindFirstChild(State.LegitPart)
                    if part then
                        local pos, vis = Camera:WorldToViewportPoint(part.Position)
                        if vis then
                            local mag = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
                            if mag < minDist then minDist = mag; target = pos end
                        end
                    end
                end
            end
            if target then
                mousemoverel((target.X - mousePos.X)/State.LegitSmooth, (target.Y - mousePos.Y)/State.LegitSmooth)
            end
        end
    end
end)

-- // ХРАНИЛИЩА
local EspStore = {}
local LastHealth = {}
local TracersStore = {}

-- // ТАБЛИЦА НАСТРОЕК
local State = {
    SilentAim = false, HitboxSize = 15, SilentFov = 150, HitboxTransparency = 0.8, Spinbot = false, SpinSpeed = 50,
    LegitAim = false, LegitSmooth = 5, LegitFov = 100, LegitPart = "Head",
    HitSound = false, NoRecoil = true,
    Bhop = false, BhopSpeed = 25, Fly = false, FlySpeed = 50,
    Esp = false, EspNames = false, EspHealth = false, Tracers = false,
    Crosshair = true, SpecList = true, CameraFOV = 80, ThirdPerson = false,
    HandMaterial = "Default", HandTransparency = 0, HandColor = Color3.fromRGB(255, 255, 255),
    NightMode = false, WorldTint = Color3.fromRGB(255, 255, 255), Brightness = 1, Exposure = 0
}

-- // ФУНКЦИИ
local function GetRGB() return Color3.fromHSV(tick() * 0.5 % 1, 1, 1) end
local function PlayHitSound()
    local sound = Instance.new("Sound", game:GetService("SoundService"))
    sound.SoundId = "rbxassetid://1255557831"; sound.Volume = 5; sound:Play()
    game:GetService("Debris"):AddItem(sound, 1)
end

-- // ВКЛАДКИ
local TabRage = Window:CreateTab("Rage Bot", "zap")
local TabLegit = Window:CreateTab("Legit Bot", "crosshair")
local TabMovement = Window:CreateTab("Movement", "move")
local TabVisuals = Window:CreateTab("Visuals", "eye")
local TabWorld = Window:CreateTab("World", "map")

-- (Контент вкладок оставлен без изменений, чтобы ничего не вырезать)
TabRage:CreateToggle({Name = "OP Hitbox (Silent Aim)", CurrentValue = false, Callback = function(v) State.SilentAim = v end})
TabRage:CreateSlider({Name = "Hitbox Size", Range = {1, 100}, Increment = 1, CurrentValue = 15, Callback = function(v) State.HitboxSize = v end})
TabRage:CreateSlider({Name = "Hitbox Transparency", Range = {0, 1}, Increment = 0.1, CurrentValue = 0.8, Callback = function(v) State.HitboxTransparency = v end})
TabRage:CreateSlider({Name = "Silent FOV", Range = {10, 800}, Increment = 10, CurrentValue = 150, Callback = function(v) State.SilentFov = v end})
TabRage:CreateToggle({Name = "Spinbot", CurrentValue = false, Callback = function(v) State.Spinbot = v end})
TabRage:CreateSlider({Name = "Spin Speed", Range = {1, 300}, Increment = 1, CurrentValue = 50, Callback = function(v) State.SpinSpeed = v end})

TabLegit:CreateToggle({Name = "Legit Aimbot (Smooth)", CurrentValue = false, Callback = function(v) State.LegitAim = v end})
TabLegit:CreateSlider({Name = "Smoothness", Range = {1, 20}, Increment = 1, CurrentValue = 5, Callback = function(v) State.LegitSmooth = v end})
TabLegit:CreateSlider({Name = "Legit FOV", Range = {10, 400}, Increment = 5, CurrentValue = 100, Callback = function(v) State.LegitFov = v end})
TabLegit:CreateDropdown({Name = "Target Part", Options = {"Head", "HumanoidRootPart"}, CurrentOption = "Head", Callback = function(v) State.LegitPart = v end})
TabLegit:CreateToggle({Name = "Hit Sound (Bell)", CurrentValue = false, Callback = function(v) State.HitSound = v end})
TabLegit:CreateToggle({Name = "No Recoil / Spread", CurrentValue = true, Callback = function(v) State.NoRecoil = v end})

TabMovement:CreateToggle({Name = "Bhop", CurrentValue = false, Callback = function(v) State.Bhop = v end})
TabMovement:CreateSlider({Name = "Bhop Speed", Range = {10, 100}, Increment = 1, CurrentValue = 25, Callback = function(v) State.BhopSpeed = v end})
TabMovement:CreateToggle({Name = "Fly Mode", CurrentValue = false, Callback = function(v) State.Fly = v end})
TabMovement:CreateSlider({Name = "Fly Speed", Range = {10, 300}, Increment = 5, CurrentValue = 50, Callback = function(v) State.FlySpeed = v end})

TabVisuals:CreateSection("ESP Settings")
TabVisuals:CreateToggle({Name = "Highlight ESP", CurrentValue = false, Callback = function(v) State.Esp = v end})
TabVisuals:CreateToggle({Name = "Show Names + Dist", CurrentValue = false, Callback = function(v) State.EspNames = v end})
TabVisuals:CreateToggle({Name = "Show Health Bar", CurrentValue = false, Callback = function(v) State.EspHealth = v end})
TabVisuals:CreateToggle({Name = "Tracers", CurrentValue = false, Callback = function(v) State.Tracers = v end})
TabVisuals:CreateToggle({Name = "RGB Pro-Crosshair", CurrentValue = true, Callback = function(v) State.Crosshair = v end})
TabVisuals:CreateToggle({Name = "Spectator List", CurrentValue = true, Callback = function(v) State.SpecList = v end})
TabVisuals:CreateSlider({Name = "Field of View", Range = {70, 130}, Increment = 1, CurrentValue = 80, Callback = function(v) State.CameraFOV = v end})
TabVisuals:CreateToggle({Name = "Unlock Third Person", CurrentValue = false, Callback = function(v) State.ThirdPerson = v end})

TabVisuals:CreateSection("Viewmodel Mods")
TabVisuals:CreateDropdown({Name = "Hand/Weapon Material", Options = {"Default", "Neon", "ForceField", "Glass", "Plastic"}, CurrentOption = "Default", Callback = function(v) State.HandMaterial = v end})
TabVisuals:CreateSlider({Name = "Material Transparency", Range = {0, 1}, Increment = 0.1, CurrentValue = 0, Callback = function(v) State.HandTransparency = v end})
TabVisuals:CreateColorPicker({Name = "Hand Color", Color = Color3.fromRGB(255,255,255), Callback = function(v) State.HandColor = v end})

TabWorld:CreateToggle({Name = "Night Mode", CurrentValue = false, Callback = function(v) State.NightMode = v end})
TabWorld:CreateColorPicker({Name = "World Tint", Color = Color3.fromRGB(255, 255, 255), Callback = function(v) State.WorldTint = v end})
TabWorld:CreateSlider({Name = "Brightness", Range = {0, 10}, Increment = 0.1, CurrentValue = 1, Callback = function(v) State.Brightness = v end})
TabWorld:CreateSlider({Name = "Exposure (Darkness)", Range = {-5, 5}, Increment = 0.1, CurrentValue = 0, Callback = function(v) State.Exposure = v end})

-- // CORE RENDER LOOP
RunService.RenderStepped:Connect(function()
    local color = GetRGB()
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    WLabel.Text = string.format("SINGULATION.WTF | %s | %dms", LP.Name, math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue()))
    WLabel.TextColor3 = color
    Camera.FieldOfView = State.CameraFOV
    Lighting.ClockTime = State.NightMode and 0 or 14
    Lighting.Ambient = State.WorldTint
    Lighting.OutdoorAmbient = State.WorldTint
    Lighting.Brightness = State.Brightness
    Lighting.ExposureCompensation = State.Exposure

    -- ESP ЛОГИКА
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LP then
            local char = p.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            local hrp = char and char:FindFirstChild("HumanoidRootPart")

            if not char or not hum or hum.Health <= 0 or not hrp then
                if EspStore[p] then for _, d in pairs(EspStore[p]) do d.Visible = false end end
                if TracersStore[p] then TracersStore[p].Visible = false end
                continue
            end

            -- Хитсаунд
            if State.HitSound and (p.Team ~= LP.Team or p.Team == nil) then
                if LastHealth[p] and hum.Health < LastHealth[p] then PlayHitSound() end
                LastHealth[p] = hum.Health
            end

            -- Создание ESP объектов
            if not EspStore[p] then
                EspStore[p] = {
                    Name = Drawing.new("Text"),
                    HOutline = Drawing.new("Line"),
                    HBar = Drawing.new("Line")
                }
                EspStore[p].Name.Size = 14
                EspStore[p].Name.Center = true
                EspStore[p].Name.Outline = true
            end

            local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
            local enemy = (p.Team ~= LP.Team or p.Team == nil)
            local e = EspStore[p]

            -- Подсветка (Highlight)
            if enemy and State.Esp then
                local h = char:FindFirstChild("Highlight") or Instance.new("Highlight", char)
                h.Enabled = true; h.FillColor = color
            elseif char:FindFirstChild("Highlight") then 
                char.Highlight.Enabled = false 
            end

            if onScreen and enemy then
                -- Расчет размеров для корректного позиционирования
                local topPos = Camera:WorldToViewportPoint(hrp.Position + Vector3.new(0, 3, 0))
                local bottomPos = Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0, 3.5, 0))
                local h = math.abs(topPos.Y - bottomPos.Y)
                local w = h / 2

                -- Имена
                if State.EspNames then
                    local dist = math.floor((LP.Character.HumanoidRootPart.Position - hrp.Position).Magnitude)
                    e.Name.Visible = true
                    e.Name.Text = p.Name .. " [" .. dist .. "m]"
                    e.Name.Position = Vector2.new(pos.X, pos.Y - (h/2) - 20)
                    e.Name.Color = color
                else e.Name.Visible = false end

                -- Здоровье
                if State.EspHealth then
                    local hpPct = math.clamp(hum.Health/hum.MaxHealth, 0, 1)
                    e.HOutline.Visible = true; e.HBar.Visible = true
                    e.HOutline.From = Vector2.new(pos.X - w/2 - 5, pos.Y - h/2)
                    e.HOutline.To = Vector2.new(pos.X - w/2 - 5, pos.Y + h/2)
                    e.HOutline.Color = Color3.new(0,0,0)
                    e.HOutline.Thickness = 3

                    e.HBar.From = Vector2.new(pos.X - w/2 - 5, pos.Y + h/2)
                    e.HBar.To = Vector2.new(pos.X - w/2 - 5, pos.Y + h/2 - (h * hpPct))
                    e.HBar.Color = Color3.fromHSV(hpPct * 0.3, 1, 1) -- От красного к зеленому
                    e.HBar.Thickness = 2
                else e.HOutline.Visible = false; e.HBar.Visible = false end

                -- Трейсеры
                if State.Tracers then
                    if not TracersStore[p] then TracersStore[p] = Drawing.new("Line") end
                    TracersStore[p].Visible = true
                    TracersStore[p].From = Vector2.new(center.X, Camera.ViewportSize.Y)
                    TracersStore[p].To = Vector2.new(pos.X, pos.Y + h/2)
                    TracersStore[p].Color = color
                elseif TracersStore[p] then TracersStore[p].Visible = false end
            else
                for _, d in pairs(e) do d.Visible = false end
                if TracersStore[p] then TracersStore[p].Visible = false end
            end
        end
    end

    -- Crosshair
    if State.Crosshair then
        local spin = tick() * 12
        Cursor1.Visible = true; Cursor1.Color = color; Cursor1.From = center + Vector2.new(math.cos(spin)*12, math.sin(spin)*12); Cursor1.To = center + Vector2.new(math.cos(spin+math.pi)*12, math.sin(spin+math.pi)*12)
        Cursor2.Visible = true; Cursor2.Color = color; Cursor2.From = center + Vector2.new(math.cos(spin+math.pi/2)*12, math.sin(spin+math.pi/2)*12); Cursor2.To = center + Vector2.new(math.cos(spin-math.pi/2)*12, math.sin(spin-math.pi/2)*12)
    else Cursor1.Visible = false; Cursor2.Visible = false end

    SilentCircle.Visible = State.SilentAim; SilentCircle.Position = center; SilentCircle.Radius = State.SilentFov; SilentCircle.Color = color
    LegitCircle.Visible = State.LegitAim; LegitCircle.Position = center; LegitCircle.Radius = State.LegitFov; LegitCircle.Color = Color3.new(1,1,1)

    -- SpecList
    if State.SpecList then
        local s = "SPECTATORS:\n"
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= LP and (not v.Character or not v.Character:FindFirstChild("Humanoid") or v.Character.Humanoid.Health <= 0) then s = s .. " > " .. v.Name .. "\n" end
        end
        SpecLabel.Text = s; SpecLabel.Visible = true; SpecLabel.TextColor3 = color
    else SpecLabel.Visible = false end

    -- РУКИ И ОРУЖИЕ (ИСПРАВЛЕНО)
    local vm = Camera:FindFirstChild("Viewmodel") or Camera:FindFirstChild("Arms")
    if vm then
        for _, part in pairs(vm:GetDescendants()) do
            if part:IsA("BasePart") then
                -- Убираем текстуры перчаток/рукавов, чтобы видеть цвет
                if part:FindFirstChildOfClass("Texture") then
                    for _, tex in pairs(part:GetChildren()) do
                        if tex:IsA("Texture") then tex:Destroy() end
                    end
                end
                
                part.Material = Enum.Material[State.HandMaterial]
                part.Transparency = State.HandTransparency
                
                -- Красим только руки
                if part.Name:lower():find("arm") or part.Name:lower():find("hand") then
                    part.Color = State.HandColor
                end
            end
        end
    end
end)

-- // ХИТБОКСЫ (RAGE)
task.spawn(function()
    while task.wait(0.3) do
        if State.SilentAim then
            for _, v in pairs(Players:GetPlayers()) do
                if v ~= LP and v.Character and (v.Team ~= LP.Team or v.Team == nil) then
                    local root = v.Character:FindFirstChild("HumanoidRootPart")
                    if root and v.Character.Humanoid.Health > 0 then
                        local pos, onScreen = Camera:WorldToViewportPoint(root.Position)
                        if onScreen and (Vector2.new(pos.X, pos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude <= State.SilentFov then
                            for _, pName in pairs({"RightUpperLeg", "LeftUpperLeg", "HeadHB", "HumanoidRootPart", "Head"}) do
                                local p = v.Character:FindFirstChild(pName)
                                if p then
                                    p.CanCollide = false
                                    p.Transparency = State.HitboxTransparency
                                    p.Size = Vector3.new(State.HitboxSize, State.HitboxSize, State.HitboxSize)
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- // LEGIT AIM
RunService.RenderStepped:Connect(function()
    if State.LegitAim then
        local target = nil; local dist = State.LegitFov
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= LP and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then
                if v.Team ~= LP.Team or v.Team == nil then
                    local p, vis = Camera:WorldToViewportPoint(v.Character[State.LegitPart].Position)
                    if vis then
                        local mag = (Vector2.new(p.X, p.Y) - UserInputService:GetMouseLocation()).Magnitude
                        if mag < dist then dist = mag; target = v end
                    end
                end
            end
        end
        if target then
            local p = Camera:WorldToViewportPoint(target.Character[State.LegitPart].Position)
            local m = UserInputService:GetMouseLocation()
            mousemoverel((p.X - m.X)/State.LegitSmooth, (p.Y - m.Y)/State.LegitSmooth)
        end
    end
end)

-- // WEAPON MODS
task.spawn(function()
    while task.wait(1) do
        if State.NoRecoil then
            pcall(function()
                for _, v in pairs(getgc(true)) do
                    if type(v) == "table" and (rawget(v, "Recoil") or rawget(v, "Spread")) then
                        v.Recoil = 0; v.Spread = 0; v.Accuracy = 0; v.WepSpread = 0; v.MaxSpread = 0
                        v.RecoilX = 0; v.RecoilY = 0
                    end
                end
            end)
        end
    end
end)

-- // MOVEMENT
RunService.Heartbeat:Connect(function()
    if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        local hrp, hum = LP.Character.HumanoidRootPart, LP.Character.Humanoid
        if State.Fly then
            hrp.Velocity = Vector3.new(0, 0.1, 0)
            local move = Vector3.new()
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= Camera.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += Camera.CFrame.RightVector end
            hrp.CFrame += move * (State.FlySpeed / 50)
        end
        if State.Bhop and UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            hum.Jump = true
            if hum.MoveDirection.Magnitude > 0 then hrp.Velocity = Vector3.new(hum.MoveDirection.X * State.BhopSpeed, hrp.Velocity.Y, hum.MoveDirection.Z * State.BhopSpeed) end
        end
        if State.Spinbot then hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(State.SpinSpeed), 0) end
    end
    LP.CameraMaxZoomDistance = State.ThirdPerson and 40 or 0.5
end)
